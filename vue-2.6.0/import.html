<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>捡到一颗白矮星</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="总是听到自己心跳的声音">
    <link rel="preload" href="/mylife/assets/css/0.styles.fc64af32.css" as="style"><link rel="preload" href="/mylife/assets/js/app.e5007391.js" as="script"><link rel="preload" href="/mylife/assets/js/2.1a757213.js" as="script"><link rel="preload" href="/mylife/assets/js/15.d497dbf9.js" as="script"><link rel="prefetch" href="/mylife/assets/js/10.ddba6f7d.js"><link rel="prefetch" href="/mylife/assets/js/11.131d49be.js"><link rel="prefetch" href="/mylife/assets/js/12.d7120a9f.js"><link rel="prefetch" href="/mylife/assets/js/13.a78dea17.js"><link rel="prefetch" href="/mylife/assets/js/14.c8afcf48.js"><link rel="prefetch" href="/mylife/assets/js/16.bc6f7740.js"><link rel="prefetch" href="/mylife/assets/js/17.40433173.js"><link rel="prefetch" href="/mylife/assets/js/18.ac5f649e.js"><link rel="prefetch" href="/mylife/assets/js/19.7ddc6507.js"><link rel="prefetch" href="/mylife/assets/js/20.1b19e468.js"><link rel="prefetch" href="/mylife/assets/js/21.c283fa7e.js"><link rel="prefetch" href="/mylife/assets/js/22.b70fefc9.js"><link rel="prefetch" href="/mylife/assets/js/23.c17da845.js"><link rel="prefetch" href="/mylife/assets/js/24.77dcfd42.js"><link rel="prefetch" href="/mylife/assets/js/25.df3f3611.js"><link rel="prefetch" href="/mylife/assets/js/26.554398ff.js"><link rel="prefetch" href="/mylife/assets/js/27.5b6289aa.js"><link rel="prefetch" href="/mylife/assets/js/28.d0c806db.js"><link rel="prefetch" href="/mylife/assets/js/3.b8c48841.js"><link rel="prefetch" href="/mylife/assets/js/4.fca74266.js"><link rel="prefetch" href="/mylife/assets/js/5.0c495115.js"><link rel="prefetch" href="/mylife/assets/js/6.dd4e8536.js"><link rel="prefetch" href="/mylife/assets/js/7.30939716.js"><link rel="prefetch" href="/mylife/assets/js/8.5477dec8.js"><link rel="prefetch" href="/mylife/assets/js/9.77d79079.js">
    <link rel="stylesheet" href="/mylife/assets/css/0.styles.fc64af32.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mylife/" class="home-link router-link-active"><!----> <span class="site-name">捡到一颗白矮星</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mylife/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/chunmu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mylife/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/chunmu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/mylife/" class="sidebar-link">Home</a></li><li><a href="/mylife/todo/" class="sidebar-link">要和宝宝要做的一百件事</a></li><li><a href="/mylife/noagain/" class="sidebar-link">让宝宝不开心的事情</a></li><li><a href="/mylife/source/" class="sidebar-link">资源收集</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>vue-2.6.0</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mylife/vue-2.6.0/import.html" class="active sidebar-link">import vue后发生的事情</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mylife/vue-2.6.0/import.html#_1-vue工程结构" class="sidebar-link">1. vue工程结构</a></li><li class="sidebar-sub-header"><a href="/mylife/vue-2.6.0/import.html#_2-vue" class="sidebar-link">2. Vue</a></li><li class="sidebar-sub-header"><a href="/mylife/vue-2.6.0/import.html#_3-剩余挂载" class="sidebar-link">3. 剩余挂载</a></li><li class="sidebar-sub-header"><a href="/mylife/vue-2.6.0/import.html#结语" class="sidebar-link">结语</a></li></ul></li><li><a href="/mylife/vue-2.6.0/api.html" class="sidebar-link">vue源码阅读之api解析</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/mylife/less/" class="sidebar-link">less</a></li><li><a href="/mylife/color/" class="sidebar-link">color</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>本人前端小透明一枚，如果对vue理解有什么不对或者不够的地方，请各位大大理解斧正，谢谢支持。
本篇文章对应的vue源码为2.6.0-release版本，阅读愉快。</p></blockquote> <h2 id="_1-vue工程结构"><a href="#_1-vue工程结构" class="header-anchor">#</a> 1. vue工程结构</h2> <blockquote><p>这个部分有很多只是挂载一个api的操作，采取部分解析，部分跳过策略，跳过部分将会在接下来的系列中体积</p></blockquote> <h3 id="_1-1-图片展示完整工程目录"><a href="#_1-1-图片展示完整工程目录" class="header-anchor">#</a> 1.1 图片展示完整工程目录</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/11/25/16ea0b6d800735b1?w=1102&amp;h=463&amp;f=png&amp;s=79896" alt=""></p> <h3 id="_1-2-这边是我们比较关注的文件目录"><a href="#_1-2-这边是我们比较关注的文件目录" class="header-anchor">#</a> 1.2 这边是我们比较关注的文件目录</h3> <div class="language- extra-class"><pre><code>|-- vue2.6.0-release
    |-- flow                      // 关于flow文件目录 可怜它烂尾了
    |-- scripts                   // 关于构建脚本文件目录
    |-- src
        |-- compiler              // 编译模块
            |-- codegen           // 代码生成
            |-- directives        // 指令  v-bind  v-model  v-on
            |-- parser            // ast语法树生成部分
        |-- core                  // 核心模块
            |-- components        // 内置组件 KeepAlive
            |-- global-api        // extend, assets, mixin, use)，observer，util
            |-- instance          // render相关 以及vue构造函数定义 生命周期钩子挂载 原型链上实例方法的挂载
            |-- observer          // 响应式的实现
            |-- util              // 工具包 主要是 debug，lang，next-tick，options(合并策略)，props(props处理)，env运行环境嗅探
            |-- vdom              // 虚拟dom实现
        |-- platforms             // 运行平台相关  web || weex
        |-- server                // 服务端渲染
        |-- sfc                   // 单文件编译为js文件
        |-- shared                // 基础工具包和生命周期钩子敞亮
    |-- test                      // 测试部分
    |-- types
</code></pre></div><h3 id="_1-3-config文件"><a href="#_1-3-config文件" class="header-anchor">#</a> 1.3 config文件</h3> <blockquote><p>各种类型输出文件的配置文件，关于<a href="https://segmentfault.com/a/1190000012419990" target="_blank" rel="noopener noreferrer">UMD, CommonJS, AMD<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以查阅这篇文章
也可以查看<a href="https://chunmu.github.io/mylife/javascript/javascript-1.html#AMD,UMD,CMD,CommonJS,ES6module" target="_blank" rel="noopener noreferrer">AMD,UMD,CMD,CommonJS,ES6module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">const</span> builds <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// Runtime+compiler CommonJS build (CommonJS)</span>
  <span class="token comment">// 这是我这次学习的类型  cjs  nodejs环境</span>
  <span class="token string">'web-full-cjs-dev'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'web/entry-runtime-with-compiler.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 对应的入口文件</span>
    dest<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'dist/vue.common.dev.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    env<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span> he<span class="token operator">:</span> <span class="token string">'./entity-decoder'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    banner
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'web-full-cjs-prod'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'web/entry-runtime-with-compiler.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 对应的入口文件</span>
    dest<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'dist/vue.common.prod.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    env<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span> he<span class="token operator">:</span> <span class="token string">'./entity-decoder'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    banner
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_1-3-1-打包时的变量替换"><a href="#_1-3-1-打包时的变量替换" class="header-anchor">#</a> 1.3.1 打包时的变量替换</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token comment">// 替换打包中的同名变量值,比如version是一个动态的且在打包时由我们指定</span>
  <span class="token comment">// 获取package.json中的版本号，在代码中会替换vue.version = version的值</span>
  <span class="token comment">// 一般是开关类  还有标记类</span>

  <span class="token comment">//   启动后发现的有 </span>
  <span class="token comment">// 1. __WEEX__   </span>
  <span class="token comment">// 2. __WEEX_VERSION__   </span>
  <span class="token comment">// 3. __VERSION__   </span>
  <span class="token comment">// 4. process.env.NEW_SLOT_SYNTAX     // 是否使用新的slot语法</span>
  <span class="token comment">// 5. process.env.VBIND_PROP_SHORTHAND  // 是否启用快捷绑定语法</span>
  <span class="token comment">// 6. process.env.NODE_ENV  // 当前环境  dev=development   prod=production(生产环境)会移除掉不必要的告警和提示等</span>
  <span class="token comment">// built-in vars</span>
  <span class="token keyword">const</span> vars <span class="token operator">=</span> <span class="token punctuation">{</span>
    __WEEX__<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>opts<span class="token punctuation">.</span>weex<span class="token punctuation">,</span>
    __WEEX_VERSION__<span class="token operator">:</span> weexVersion<span class="token punctuation">,</span>
    __VERSION__<span class="token operator">:</span> version
  <span class="token punctuation">}</span>

</code></pre></div><h4 id="_1-3-2-别名设定"><a href="#_1-3-2-别名设定" class="header-anchor">#</a> 1.3.2 别名设定</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// 在代码应用中  import ... from 'core'</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  vue<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/platforms/web/entry-runtime-with-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// vue全版本入口</span>
  compiler<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 编译器入口</span>
  core<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/core'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// vue核心文件</span>
  shared<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/shared'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 工具包</span>
  web<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/platforms/web'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// web平台入口</span>
  weex<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/platforms/weex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// weex平台入口</span>
  server<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/server'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ssr入口</span>
  entries<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/entries'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//</span>
  sfc<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/sfc'</span><span class="token punctuation">)</span> <span class="token comment">// </span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_2-vue"><a href="#_2-vue" class="header-anchor">#</a> 2. Vue</h2> <p>在使用vue的时候  会有下面这些用法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
Vue<span class="token punctuation">.</span><span class="token function">mixins</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>所以肯定有这么一个地方  定义 Vue () {}，我们可以从config中的入口文件开始寻找Vue</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token operator">=&gt;</span> scripts<span class="token operator">/</span>config web<span class="token operator">/</span>entry<span class="token operator">-</span>runtime<span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>compiler      <span class="token comment">// 打包入口web/entry-runtime-with-compiler</span>
<span class="token operator">=&gt;</span> src<span class="token operator">/</span>platforms<span class="token operator">/</span>web<span class="token operator">/</span>entry<span class="token operator">-</span>runtime<span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>compiler<span class="token punctuation">.</span>js    <span class="token comment">// import Vue from './runtime/index'</span>
<span class="token operator">=&gt;</span> src<span class="token operator">/</span>platforms<span class="token operator">/</span>web<span class="token operator">/</span>runtime<span class="token operator">/</span>index<span class="token punctuation">.</span>js                  <span class="token comment">// import Vue from 'core/index'</span>
<span class="token operator">=&gt;</span> src<span class="token operator">/</span>core<span class="token operator">/</span>index                                      <span class="token comment">// import Vue from './instance/index'</span>
<span class="token operator">=&gt;</span> src<span class="token operator">/</span>core<span class="token operator">/</span>instance<span class="token operator">/</span>index                             <span class="token comment">// 在这里 function Vue</span>

</code></pre></div><h3 id="_2-1-vue声明"><a href="#_2-1-vue声明" class="header-anchor">#</a> 2.1 Vue声明</h3> <p>Vue构造函数声明定义</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在测试或者开发环境检测实例是否是通过new Vue的形式生成的 否则告警 因为后续的所有操作都是围绕vue实例进行</span>
  <span class="token comment">// new Vue() ✔</span>
  <span class="token comment">// Vue()     ×</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Vue is a constructor and should be called with the `new` keyword'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment">// 实例执行方法  我们后续会学习到</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_2-2-vue-prototype-api-vue-api"><a href="#_2-2-vue-prototype-api-vue-api" class="header-anchor">#</a> 2.2 Vue.prototype API &amp; Vue API</h3> <blockquote><p>接下来是vue的全局API包装 分为实例原型对象挂载和构造函数API挂载 区别请查看<a href="https://juejin.im/post/5b729c24f265da280f3ad010" target="_blank" rel="noopener noreferrer">一张图理解JS的原型（prototype、<em>proto</em>、constructor的三角关系）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
没有进行实际功能讲解的  都将会在后续文章中出现</p></blockquote> <h4 id="_2-2-1-initmixin"><a href="#_2-2-1-initmixin" class="header-anchor">#</a> 2.2.1 initMixin</h4> <div class="language- extra-class"><pre class="language-text"><code>// 初始化方法挂载
Vue.prototype._init = function () {}
</code></pre></div><h4 id="_2-2-2-statemixin"><a href="#_2-2-2-statemixin" class="header-anchor">#</a> 2.2.2 stateMixin</h4> <blockquote><p>data, props数据代理设置</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">/**
   * 数据劫持 这也是Vue实现原理核心 这边用于数据代理
   * 所有Vue实例中形如this.xxx访问data都是在访问this._data.xxx
   * 所有Vue实例中形如this.xxx访问props都是在访问this._props.xxx
   * 劫持data set 对更改this.data指向进行更改的操作进行告警
   * 劫持props set 提示该对象只读 
   * */</span>
  <span class="token keyword">const</span> dataDef <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  dataDef<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token punctuation">}</span> 
  <span class="token keyword">const</span> propsDef <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  propsDef<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_props <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dataDef<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">'Avoid replacing instance root $data. '</span> <span class="token operator">+</span>
        <span class="token string">'Use nested data properties instead.'</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    propsDef<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$props is readonly.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$data'</span><span class="token punctuation">,</span> dataDef<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$props'</span><span class="token punctuation">,</span> propsDef<span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token comment">// observer中的set，delete方法</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">set</span>                  <span class="token comment">// 设置观测对象</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">delete</span> <span class="token operator">=</span> del               <span class="token comment">// 观测对象的删除</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$watch                      <span class="token comment">// 实例上的$watch</span>

</code></pre></div><h4 id="_2-2-3-eventsmixin"><a href="#_2-2-3-eventsmixin" class="header-anchor">#</a> 2.2.3 eventsMixin</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$on</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>      <span class="token comment">// 添加监听器</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$once</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment">// 添加一次性监听器</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$off</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>     <span class="token comment">// 卸载监听器</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$emit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment">// 发射事件</span>

</code></pre></div><h4 id="_2-2-4-lifecyclemixin"><a href="#_2-2-4-lifecyclemixin" class="header-anchor">#</a> 2.2.4 lifecycleMixin</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>         <span class="token comment">// 视图更新 注重点在于视图组件更新</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment">// 强制更新 注重点在于强制触发observer相应更新</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$destroy</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token comment">// 销毁当前实例</span>

</code></pre></div><h4 id="_2-2-5-rendermixin"><a href="#_2-2-5-rendermixin" class="header-anchor">#</a> 2.2.5 renderMixin</h4> <blockquote><p>渲染相关的处理和API挂载</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token comment">// https://chunmu.github.io/mylife/vue-2.6.0/api.html#_1-nexttick</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$nextTick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>         <span class="token comment">// 视图更新 注重点在于视图组件更新 请查阅</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>           <span class="token comment">// 强制更新 注重点在于强制触发observer相应更新</span>

</code></pre></div><h4 id="_2-2-6-installrenderhelpers"><a href="#_2-2-6-installrenderhelpers" class="header-anchor">#</a> 2.2.6 installRenderHelpers</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// 后续将逐一补充其作用 都是挂载操作 没有执行</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">installRenderHelpers</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span>_o <span class="token operator">=</span> markOnce                  <span class="token comment">// 标记once指令相关属性</span>
  target<span class="token punctuation">.</span>_n <span class="token operator">=</span> toNumber
  target<span class="token punctuation">.</span>_s <span class="token operator">=</span> toString
  target<span class="token punctuation">.</span>_l <span class="token operator">=</span> renderList                <span class="token comment">// 渲染for循环</span>
  target<span class="token punctuation">.</span>_t <span class="token operator">=</span> renderSlot
  target<span class="token punctuation">.</span>_q <span class="token operator">=</span> looseEqual
  target<span class="token punctuation">.</span>_i <span class="token operator">=</span> looseIndexOf
  target<span class="token punctuation">.</span>_m <span class="token operator">=</span> renderStatic              <span class="token comment">// 渲染静态内容</span>
  target<span class="token punctuation">.</span>_f <span class="token operator">=</span> resolveFilter
  target<span class="token punctuation">.</span>_k <span class="token operator">=</span> checkKeyCodes
  target<span class="token punctuation">.</span>_b <span class="token operator">=</span> bindObjectProps           <span class="token comment">// 动态属性绑定</span>
  target<span class="token punctuation">.</span>_v <span class="token operator">=</span> createTextVNode           <span class="token comment">// 创建Text VNode节点</span>
  target<span class="token punctuation">.</span>_e <span class="token operator">=</span> createEmptyVNode          <span class="token comment">// 创建empty VNode节点</span>
  target<span class="token punctuation">.</span>_u <span class="token operator">=</span> resolveScopedSlots
  target<span class="token punctuation">.</span>_g <span class="token operator">=</span> bindObjectListeners
  target<span class="token punctuation">.</span>_d <span class="token operator">=</span> bindDynamicKeys           <span class="token comment">//  &lt;div :[username]=&quot;className&quot;&gt;&lt;/div&gt;，设置动态key的方法</span>
  target<span class="token punctuation">.</span>_p <span class="token operator">=</span> prependModifier
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_2-3-initglobalapi"><a href="#_2-3-initglobalapi" class="header-anchor">#</a> 2.3 initGlobalAPI</h3> <blockquote><p>可以注意到前面都是配置Vue.prototype实例方法  接下来是构造函数API挂载</p></blockquote> <h4 id="_2-3-1-代理config"><a href="#_2-3-1-代理config" class="header-anchor">#</a> 2.3.1 代理config</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token comment">/**
   * 劫持config配置的set方法 只读对象 不应该直接修改Vue.config  而是在传入参数中按需配置字段
   * */</span>
  <span class="token keyword">const</span> configDef <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  configDef<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> config
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    configDef<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">'Do not replace the Vue.config object, set individual fields instead.'</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> <span class="token string">'config'</span><span class="token punctuation">,</span> configDef<span class="token punctuation">)</span>

</code></pre></div><h4 id="_2-3-2-全局配置config解析"><a href="#_2-3-2-全局配置config解析" class="header-anchor">#</a> 2.3.2 全局配置config解析</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// 关于config全局配置字段解析 有遗漏的后续逐渐补上</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  optionMergeStrategies<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token comment">// 各种合并策略的配置 最好不要去改动它 除非对它的机制非常熟悉</span>
                                                          <span class="token comment">// Object.create(null) 这样创建的对象相对而言更纯净</span>
  silent<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                                          <span class="token comment">// 是否保持静默 禁止console.warn输出</span>
  productionTip<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">,</span>   <span class="token comment">// 控制开发模式的一个提醒</span>
  devtools<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">,</span>        <span class="token comment">// devtools工具开关</span>
  performance<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                                     <span class="token comment">// 是否输出记录性能数据 比如vue的渲染耗时 编译耗时记录</span>
  errorHandler<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>                                     <span class="token comment">// 可以自定义错误处理方法 比如收集vue error上报等</span>
  warnHandler<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>                                      <span class="token comment">// 可以自定义warn处理方法 比如收集vue warn上报等</span>
  ignoredElements<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                                    <span class="token comment">// 可忽略编译的自定义标签</span>
  keyCodes<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token comment">// 键值合集</span>
  isReservedTag<span class="token operator">:</span> no<span class="token punctuation">,</span>                                      <span class="token comment">// 某标签是否保留标签 放到全局不知道是啥作用</span>
  isReservedAttr<span class="token operator">:</span> no<span class="token punctuation">,</span>                                     <span class="token comment">// 某属性是否保留属性 放到全局不知道是啥作用</span>
  isUnknownElement<span class="token operator">:</span> no<span class="token punctuation">,</span>                                   <span class="token comment">// 未知元素</span>
  getTagNamespace<span class="token operator">:</span> noop<span class="token punctuation">,</span>                                  <span class="token comment">// 获取标签命名空间</span>
  parsePlatformTagName<span class="token operator">:</span> identity<span class="token punctuation">,</span>
  mustUseProp<span class="token operator">:</span> no<span class="token punctuation">,</span>                                        <span class="token comment">// 是否必须传入的prop  比如selct标签必须接收value属性当做prop</span>
  async<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  _lifecycleHooks<span class="token operator">:</span> <span class="token constant">LIFECYCLE_HOOKS</span>                        <span class="token comment">// 生命周期钩子 beforeCreate, created, beforeMount, mounted, beforeUpdate, updated, beforeDestory, destroyed, activated, deactivated, errorCaptured, serverPrefetch</span>
<span class="token punctuation">}</span><span class="token operator">:</span> Config<span class="token punctuation">)</span>

</code></pre></div><h4 id="_2-3-3-vue-util"><a href="#_2-3-3-vue-util" class="header-anchor">#</a> 2.3.3 Vue.util</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  Vue<span class="token punctuation">.</span>util <span class="token operator">=</span> <span class="token punctuation">{</span>
    warn<span class="token punctuation">,</span>                    <span class="token comment">// 有一段格式化vue实例调用栈的处理 后续补充详情</span>
    extend<span class="token punctuation">,</span>                  <span class="token comment">// 工具文件中自定义了extend方法 for...in循环取值设值 可遍历原型链上扩展属性 assign不会</span>
    <span class="token comment">// https://chunmu.github.io/mylife/vue-2.6.0/api.html#_1-mergeOptions</span>
    mergeOptions<span class="token punctuation">,</span>            <span class="token comment">// options合并策略 new Vue(options)</span>
    defineReactive           <span class="token comment">// observer工具方法</span>
  <span class="token punctuation">}</span>

</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                <span class="token comment">// set</span>
  <span class="token comment">// https://chunmu.github.io/mylife/vue-2.6.0/api.html#_1-nexttick</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">delete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>             <span class="token comment">// delete</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">nextTick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>           <span class="token comment">// nextTick</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">observable</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>         <span class="token comment">// observable</span>

</code></pre></div><h4 id="_2-3-4-vue-options初始化"><a href="#_2-3-4-vue-options初始化" class="header-anchor">#</a> 2.3.4 Vue.options初始化</h4> <blockquote><p>初始化构造函数上options 将作为所有后续options的祖先级对象</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">/**
   * Vue.options = {
   *   components: {},
   *   directives: {},
   *   filters: {}
   * }
   * */</span>
  Vue<span class="token punctuation">.</span>options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>_base <span class="token operator">=</span> Vue                               <span class="token comment">// _base =&gt; Vue</span>
  
  <span class="token function">extend</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">,</span> builtInComponents<span class="token punctuation">)</span>     <span class="token comment">// 全局内置组件keep-alive</span>
</code></pre></div><h4 id="_2-3-5-inituse-vue-use"><a href="#_2-3-5-inituse-vue-use" class="header-anchor">#</a> 2.3.5 initUse Vue.use</h4> <p>Vue.use的实现部分，提供一个操作Vue全局或者实例相关逻辑或者api的聚合，规范化插件安装</p> <ul><li>use定义部分</li></ul> <blockquote><p>use方法返回值是Vue 所以可以链式安装插件 Vue.use(plugin1).use(plugin2)</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  Vue<span class="token punctuation">.</span><span class="token function-variable function">use</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">plugin<span class="token operator">:</span> Function <span class="token operator">|</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断同一插件是否重复注册</span>
    <span class="token keyword">const</span> installedPlugins <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedPlugins<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// additional parameters</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">toArray</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// 传入install的起始位置参数为 this = Vue</span>
    args<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token comment">// 优先尝试通过install安装插件 可以认为是Vue推荐的插件安装标准格式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin<span class="token punctuation">.</span>install <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      plugin<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>plugin<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    installedPlugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>官方文档复制一遍，说得很清楚，它的功能范围</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
MyPlugin<span class="token punctuation">.</span><span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. 添加全局方法或属性</span>
  Vue<span class="token punctuation">.</span><span class="token function-variable function">myGlobalMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 逻辑...</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 2. 添加全局资源</span>
  Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'my-directive'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">bind</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> oldVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 逻辑...</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 3. 注入组件选项</span>
  Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 逻辑...</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 4. 添加实例方法</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$myMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">methodOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 逻辑...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-3-6-initmixin-vue-mixin"><a href="#_2-3-6-initmixin-vue-mixin" class="header-anchor">#</a> 2.3.6 initMixin Vue.mixin</h4> <ul><li>Vue.mixin定义</li></ul> <p>本质是直接调用mergeOptions来进行mixins选项合并，这边就牵扯到了我们要关注的一个重点，options的合并策略</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Vue<span class="token punctuation">.</span><span class="token function-variable function">mixin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">mixin<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span> mixin<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-3-7-initextend-extend的核心实现"><a href="#_2-3-7-initextend-extend的核心实现" class="header-anchor">#</a> 2.3.7 initExtend extend的核心实现</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
Vue<span class="token punctuation">.</span><span class="token function-variable function">extend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>              <span class="token comment">// 组件扩展核心方法 后续用实际代码来解析</span>

  <span class="token comment">/**
   * Each instance constructor, including Vue, has a unique
   * cid. This enables us to create wrapped &quot;child
   * constructors&quot; for prototypal inheritance and cache them.
   */</span>
  Vue<span class="token punctuation">.</span>cid <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> cid <span class="token operator">=</span> <span class="token number">1</span>

  <span class="token comment">/**
   * Class inheritance
   */</span>
  Vue<span class="token punctuation">.</span><span class="token function-variable function">extend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">extendOptions<span class="token operator">:</span> Object</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
    extendOptions <span class="token operator">=</span> extendOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> Super <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> SuperId <span class="token operator">=</span> Super<span class="token punctuation">.</span>cid
    <span class="token keyword">const</span> cachedCtors <span class="token operator">=</span> extendOptions<span class="token punctuation">.</span>_Ctor <span class="token operator">||</span> <span class="token punctuation">(</span>extendOptions<span class="token punctuation">.</span>_Ctor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// options上挂载_Ctor用于储存</span>
    <span class="token comment">// 假定需要扩展的options = targetOptions 则下次继续用这个options去extend</span>
    <span class="token comment">// 则会有现成的 已经存在的符合条件的扩展Vue类构造函数</span>
    <span class="token comment">// 缓存已经扩展过的构造函数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 扩展一般用来建设组件</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> extendOptions<span class="token punctuation">.</span>name <span class="token operator">||</span> Super<span class="token punctuation">.</span>options<span class="token punctuation">.</span>name
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">validateComponentName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 类似Vue的构造方法</span>
    <span class="token keyword">const</span> <span class="token function-variable function">Sub</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">VueComponent</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment">// 当调用构造方法是 son = new Sub() 调用_init方法</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 改写Sub的prototype，constructor指向Vue，继承所有Vue上实例原型链上的方法属性</span>
    <span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Super</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
    <span class="token comment">// 调转原型链的构造函数执行Sub  旧有的是指向Vue</span>
    <span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Sub
    Sub<span class="token punctuation">.</span>cid <span class="token operator">=</span> cid<span class="token operator">++</span> <span class="token comment">// constructor ID，这边是跳过了1... 如果用于统计 则少了1  卧槽 总数是对的</span>
    <span class="token comment">// 此处调用mergeOptions 顶层vue</span>
    <span class="token comment">// Super.options上含有_base 会继承至Sub的options中</span>
    Sub<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>
      Super<span class="token punctuation">.</span>options<span class="token punctuation">,</span>
      extendOptions
    <span class="token punctuation">)</span>
    <span class="token comment">// 指定super</span>
    Sub<span class="token punctuation">[</span><span class="token string">'super'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Super

    <span class="token comment">// For props and computed properties, we define the proxy getters on</span>
    <span class="token comment">// the Vue instances at extension time, on the extended prototype. This</span>
    <span class="token comment">// avoids Object.defineProperty calls for each instance created.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">initProps</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span> <span class="token comment">// 设置props代理访问  this.xxx = this._props.xxx</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">initComputed</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span> <span class="token comment">// 设计到即时相应部分 后续关注</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// allow further extension/mixin/plugin usage</span>
    <span class="token comment">// 继承来自super的属性和方法</span>
    Sub<span class="token punctuation">.</span>extend <span class="token operator">=</span> Super<span class="token punctuation">.</span>extend
    Sub<span class="token punctuation">.</span>mixin <span class="token operator">=</span> Super<span class="token punctuation">.</span>mixin
    Sub<span class="token punctuation">.</span>use <span class="token operator">=</span> Super<span class="token punctuation">.</span>use

    <span class="token comment">// create asset registers, so extended classes</span>
    <span class="token comment">// can have their private assets too.</span>
    <span class="token comment">// Vue中的conponents filters directives继承</span>
    <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Sub<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> Super<span class="token punctuation">[</span>type<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// enable recursive self-lookup</span>
    <span class="token comment">// 自身可以注册为一个组件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Sub
    <span class="token punctuation">}</span>

    <span class="token comment">// keep a reference to the super options at extension time.</span>
    <span class="token comment">// later at instantiation we can check if Super's options have</span>
    <span class="token comment">// been updated.</span>
    Sub<span class="token punctuation">.</span>superOptions <span class="token operator">=</span> Super<span class="token punctuation">.</span>options
    Sub<span class="token punctuation">.</span>extendOptions <span class="token operator">=</span> extendOptions
    <span class="token comment">// 密封options</span>
    Sub<span class="token punctuation">.</span>sealedOptions <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Sub<span class="token punctuation">.</span>options<span class="token punctuation">)</span>

    <span class="token comment">// cache constructor</span>
    <span class="token comment">// 注意  用的是superId  储存的是super执行扩展之后的构造函数</span>
    cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span> <span class="token operator">=</span> Sub
    <span class="token keyword">return</span> Sub
  <span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-3-8-initassetregisters"><a href="#_2-3-8-initassetregisters" class="header-anchor">#</a> 2.3.8 initAssetRegisters</h4> <blockquote><p>这边就是Vue.component， Vue.directive，Vue.filter全局API的定义了</p></blockquote> <p>三段注册逻辑混合在一起 增加了不必要的type判断，不过又要与ASSET_TYPES保持一致，暂时没想到更好的解决方式 不过这个开销不大 不会有性能问题
个人觉得，这种资源级别的处理可以单独拆分 毕竟就算新引入一种资源  也很大可能有逻辑改动 所以注册方法加一个也就可以接受了</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
      <span class="token parameter">id<span class="token operator">:</span> string<span class="token punctuation">,</span>
      definition<span class="token operator">:</span> Function <span class="token operator">|</span> Object</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果注册的内容存在 返回对应id  注册之后是存储在对应的位置 Vue.options中的{components: {}, filters: {}, directives: {}}集合中</span>
        <span class="token comment">/**
        * Vue.component('my-component')  
        *   =&gt; 
        * Vue.options = {
        *   ...,
        *   components: {
        *     'my-component': MyComponent
        *   }
        * }
        * */</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">/* istanbul ignore if */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> type <span class="token operator">===</span> <span class="token string">'component'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 校验组件名称的合法性</span>
          <span class="token function">validateComponentName</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'component'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 优先使用component对象内部定义的name属性来命名组件 没有则使用注册时使用的id来命名 也可看成是组件使用时候的标签名</span>
          definition<span class="token punctuation">.</span>name <span class="token operator">=</span> definition<span class="token punctuation">.</span>name <span class="token operator">||</span> id
          <span class="token comment">// 这边就是用到了extend，后续我们会讲到这个</span>
          definition <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>_base<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>             
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果是指令且指令的配置为一个方法  则默认该指令的绑定和更新都是调用这个方法</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'directive'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> definition <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          definition <span class="token operator">=</span> <span class="token punctuation">{</span> bind<span class="token operator">:</span> definition<span class="token punctuation">,</span> update<span class="token operator">:</span> definition <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition
        <span class="token keyword">return</span> definition
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h4 id="_2-3-10-validatecomponentname"><a href="#_2-3-10-validatecomponentname" class="header-anchor">#</a> 2.3.10 validateComponentName</h4> <blockquote><p>组件名称合法性校验</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// 普遍支持unicode字符 包括中文  数学符号 emoji等 不过最好不要这么玩</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^[a-zA-Z][\\-\\.0-9_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>unicodeRegExp<span class="token punctuation">.</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]*$</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">'Invalid component name: &quot;'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'&quot;. Component names '</span> <span class="token operator">+</span>
      <span class="token string">'should conform to valid custom element name in html5 specification.'</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 是否保留字 保留标签 或者内建组件  slot  components  这些不能用 keep-alive等也不能用（内置组件）</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBuiltInTag</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">||</span> config<span class="token punctuation">.</span><span class="token function">isReservedTag</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">'Do not use built-in or reserved HTML elements as component '</span> <span class="token operator">+</span>
      <span class="token string">'id: '</span> <span class="token operator">+</span> name
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre></div><h2 id="_3-剩余挂载"><a href="#_3-剩余挂载" class="header-anchor">#</a> 3. 剩余挂载</h2> <h3 id="_3-1-ssr服务端渲染想相关"><a href="#_3-1-ssr服务端渲染想相关" class="header-anchor">#</a> 3.1 ssr服务端渲染想相关</h3> <blockquote><p>暂时不关注这个</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$isServer'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token operator">:</span> isServerRendering
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$ssrContext'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* istanbul ignore next */</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$vnode <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$vnode<span class="token punctuation">.</span>ssrContext
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// expose FunctionalRenderContext for ssr runtime helper installation</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> <span class="token string">'FunctionalRenderContext'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> FunctionalRenderContext
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="_3-2-vue的版本植入"><a href="#_3-2-vue的版本植入" class="header-anchor">#</a> 3.2 Vue的版本植入</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
Vue<span class="token punctuation">.</span>version <span class="token operator">=</span> <span class="token string">'__VERSION__'</span>    <span class="token comment">// 获取的是主项目package.json的版本号</span>

<span class="token comment">// 回头找找srcipts/config文件中的代码块  rullup变量设置  会在打包的工程中替换对应字串</span>
<span class="token comment">// built-in vars</span>
<span class="token keyword">const</span> vars <span class="token operator">=</span> <span class="token punctuation">{</span>
  __WEEX__<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>opts<span class="token punctuation">.</span>weex<span class="token punctuation">,</span>
  __WEEX_VERSION__<span class="token operator">:</span> weexVersion<span class="token punctuation">,</span>
  __VERSION__<span class="token operator">:</span> version
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_3-3-平台相关utils挂载和预置平台相关的内置组件和平台相关的-patch-方法"><a href="#_3-3-平台相关utils挂载和预置平台相关的内置组件和平台相关的-patch-方法" class="header-anchor">#</a> 3.3 平台相关utils挂载和预置平台相关的内置组件和平台相关的__patch__方法</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// install platform specific utils</span>
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>mustUseProp <span class="token operator">=</span> mustUseProp                            <span class="token comment">// 判断是否必须强制通过props引入</span>
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>isReservedTag <span class="token operator">=</span> isReservedTag                        <span class="token comment">// 判断是否保留标签</span>
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>isReservedAttr <span class="token operator">=</span> isReservedAttr                      <span class="token comment">// 判断是否保留属性</span>
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>getTagNamespace <span class="token operator">=</span> getTagNamespace                    <span class="token comment">// 获取命名空间</span>
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>isUnknownElement <span class="token operator">=</span> isUnknownElement                  <span class="token comment">// 无法识别的组件名称</span>


<span class="token comment">// install platform runtime directives &amp; components</span>
<span class="token function">extend</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>directives<span class="token punctuation">,</span> platformDirectives<span class="token punctuation">)</span>              <span class="token comment">// v-model&amp;v-show</span>
<span class="token function">extend</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">,</span> platformComponents<span class="token punctuation">)</span>              <span class="token comment">// Transition&amp;TransitionGroup</span>

<span class="token comment">// install platform patch function</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__patch__ <span class="token operator">=</span> inBrowser <span class="token operator">?</span> patch <span class="token operator">:</span> noop              <span class="token comment">// 分发渲染通信的核心</span>

</code></pre></div><h4 id="_3-4-mount方法-挂载api-核心方法"><a href="#_3-4-mount方法-挂载api-核心方法" class="header-anchor">#</a> 3.4 mount方法 挂载api 核心方法</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// public mount method</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  <span class="token parameter">el<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> Element<span class="token punctuation">,</span>
  hydrating<span class="token operator">?</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Component <span class="token punctuation">{</span>
  el <span class="token operator">=</span> el <span class="token operator">&amp;&amp;</span> inBrowser <span class="token operator">?</span> <span class="token function">query</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>
  <span class="token keyword">return</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_3-3-5-关于开发相关的温馨提示和devtools的初始化"><a href="#_3-3-5-关于开发相关的温馨提示和devtools的初始化" class="header-anchor">#</a> 3.3.5 关于开发相关的温馨提示和devtools的初始化</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// devtools global hook</span>
<span class="token comment">/* istanbul ignore next */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>inBrowser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>devtools<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>devtools<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        devtools<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span> Vue<span class="token punctuation">)</span>                        <span class="token comment">// devtools使用</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'test'</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">[</span>console<span class="token punctuation">.</span>info <span class="token operator">?</span> <span class="token string">'info'</span> <span class="token operator">:</span> <span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
          <span class="token string">'Download the Vue Devtools extension for a better development experience:\n'</span> <span class="token operator">+</span>
          <span class="token string">'https://github.com/vuejs/vue-devtools'</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'test'</span> <span class="token operator">&amp;&amp;</span>
      config<span class="token punctuation">.</span>productionTip <span class="token operator">!==</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span>                    <span class="token comment">// new Vue({config})的config中productionTip变量的使用位置</span>
      <span class="token keyword">typeof</span> console <span class="token operator">!==</span> <span class="token string">'undefined'</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">[</span>console<span class="token punctuation">.</span>info <span class="token operator">?</span> <span class="token string">'info'</span> <span class="token operator">:</span> <span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You are running Vue in development mode.\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Make sure to turn on production mode when deploying for production.\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">See more tips at https://vuejs.org/guide/deployment.html</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h2> <p>上述就是Vue引入后做的一些初始化过程，经过这么一个流程之后，该有的全局API，实例api有了一个雏形，
上面过程中有执行过程的我都有进行解析，还有一些简单的方法定义也做了解析，不过核心和重点依旧没有涉及，
在下一期中我们将了解Vue的模板解析过程</p> <br> <br>
如果可以，请喝杯咖啡，ヾ(≧▽≦*)o
<p><img src="https://user-gold-cdn.xitu.io/2019/12/13/16efafe4704796ea?w=287&amp;h=288&amp;f=jpeg&amp;s=41747" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mylife/source/" class="prev">
        资源收集
      </a></span> <span class="next"><a href="/mylife/vue-2.6.0/api.html">
        vue源码阅读之api解析
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mylife/assets/js/app.e5007391.js" defer></script><script src="/mylife/assets/js/2.1a757213.js" defer></script><script src="/mylife/assets/js/15.d497dbf9.js" defer></script>
  </body>
</html>
